{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport \"./App.css\";\nimport { NotesApi } from \"./api/notesApi\"; // ✅ real API\n\n// ... clamp/genId/colorToHex stay the same\n\nexport default function App() {\n  _s();\n  const canvasRef = useRef(null);\n  const trashRef = useRef(null);\n\n  // ✅ API is the only source of truth\n  const [notes, setNotes] = useState([]);\n  const [newW, setNewW] = useState(220);\n  const [newH, setNewH] = useState(180);\n  const [newColor, setNewColor] = useState(\"yellow\");\n  const maxZ = useMemo(() => notes.reduce((m, n) => Math.max(m, n.z), 0), [notes]);\n\n  // ✅ Load from API on mount\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      try {\n        const remote = await NotesApi.getNotes();\n        if (!cancelled) setNotes(Array.isArray(remote) ? remote : []);\n      } catch (err) {\n        console.error(\"API getNotes failed:\", err);\n        if (!cancelled) setNotes([]); // or keep current\n      }\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  // ✅ Save to API (debounced) whenever notes change\n  const didInitialLoad = useRef(false);\n  const saveTimerRef = useRef(null);\n  useEffect(() => {\n    // skip saving until AFTER we have loaded once\n    if (!didInitialLoad.current) {\n      didInitialLoad.current = true;\n      return;\n    }\n    if (saveTimerRef.current) window.clearTimeout(saveTimerRef.current);\n    saveTimerRef.current = window.setTimeout(async () => {\n      try {\n        // if PUT returns saved notes, keep client synced\n        const saved = await NotesApi.putNotes(notes);\n        if (Array.isArray(saved)) setNotes(saved);\n      } catch (err) {\n        console.error(\"API putNotes failed:\", err);\n      }\n    }, 350);\n    return () => {\n      if (saveTimerRef.current) window.clearTimeout(saveTimerRef.current);\n    };\n  }, [notes]);\n\n  // ... the rest of your component stays the same (createNote/updateNote/deleteNote/etc.)\n}\n_s(App, \"kHoRFsOjwq5wPtznkv+f+Glh+hc=\");\n_c = App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["useEffect","useMemo","useRef","useState","NotesApi","App","_s","canvasRef","trashRef","notes","setNotes","newW","setNewW","newH","setNewH","newColor","setNewColor","maxZ","reduce","m","n","Math","max","z","cancelled","remote","getNotes","Array","isArray","err","console","error","didInitialLoad","saveTimerRef","current","window","clearTimeout","setTimeout","saved","putNotes","_c","$RefreshReg$"],"sources":["C:/Development/Tempo/sticky-notes/src/App.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport \"./App.css\";\nimport { Note, NoteColor } from \"./types\";\nimport { NotesApi } from \"./api/notesApi\"; // ✅ real API\n\n// ... clamp/genId/colorToHex stay the same\n\nexport default function App() {\n  const canvasRef = useRef<HTMLDivElement | null>(null);\n  const trashRef = useRef<HTMLDivElement | null>(null);\n\n  // ✅ API is the only source of truth\n  const [notes, setNotes] = useState<Note[]>([]);\n  const [newW, setNewW] = useState(220);\n  const [newH, setNewH] = useState(180);\n  const [newColor, setNewColor] = useState<NoteColor>(\"yellow\");\n\n  const maxZ = useMemo(() => notes.reduce((m, n) => Math.max(m, n.z), 0), [notes]);\n\n  // ✅ Load from API on mount\n  useEffect(() => {\n    let cancelled = false;\n\n    (async () => {\n      try {\n        const remote = await NotesApi.getNotes();\n        if (!cancelled) setNotes(Array.isArray(remote) ? remote : []);\n      } catch (err) {\n        console.error(\"API getNotes failed:\", err);\n        if (!cancelled) setNotes([]); // or keep current\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  // ✅ Save to API (debounced) whenever notes change\n  const didInitialLoad = useRef(false);\n  const saveTimerRef = useRef<number | null>(null);\n\n  useEffect(() => {\n    // skip saving until AFTER we have loaded once\n    if (!didInitialLoad.current) {\n      didInitialLoad.current = true;\n      return;\n    }\n\n    if (saveTimerRef.current) window.clearTimeout(saveTimerRef.current);\n\n    saveTimerRef.current = window.setTimeout(async () => {\n      try {\n        // if PUT returns saved notes, keep client synced\n        const saved = await NotesApi.putNotes(notes);\n        if (Array.isArray(saved)) setNotes(saved);\n      } catch (err) {\n        console.error(\"API putNotes failed:\", err);\n      }\n    }, 350);\n\n    return () => {\n      if (saveTimerRef.current) window.clearTimeout(saveTimerRef.current);\n    };\n  }, [notes]);\n\n  // ... the rest of your component stays the same (createNote/updateNote/deleteNote/etc.)\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}